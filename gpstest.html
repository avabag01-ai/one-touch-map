<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GPS Test</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- VWorld API Key (Í∏∞Ï°¥ ÌååÏùºÏóêÏÑú Í∞ÄÏ†∏Ïò¥) -->

    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* GPS ÌååÎûÄ Ï†ê Ïä§ÌÉÄÏùº */
        .gps-pulse-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gps-dot {
            width: 14px;
            height: 14px;
            background-color: #2196F3;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .gps-pulse {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(33, 150, 243, 0.4);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            z-index: 1;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.5);
                opacity: 0.8;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* ÌòÑÏû¨ ÏúÑÏπò Î≤ÑÌäº */
        #my-loc-btn {
            position: fixed;
            bottom: 30px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>

    <div id="map"></div>
    <button id="my-loc-btn">üìç</button>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet Rotate (ÌöåÏ†Ñ ÏßÄÏõê) -->
    <script src="https://unpkg.com/leaflet-rotate@0.2.8/dist/leaflet-rotate-src.js"></script>

    <script>
        const VWORLD_KEY = '58661685-6101-382C-AC6E-76C636066265'; // ÏÇ¨Ïö©Ïûê ÌÇ§
        let map;
        let gpsMarker = null;
        let watchId = null;

        function init() {
            // 1. ÏßÄÎèÑ ÏÉùÏÑ± (ÌöåÏ†Ñ ÌóàÏö©)
            map = L.map('map', {
                rotate: true,
                touchRotate: true,
                center: [37.5665, 126.9780],
                zoom: 16
            });

            // 2. VWorld Î†àÏù¥Ïñ¥
            L.tileLayer(`https://api.vworld.kr/req/wmts/1.0.0/${VWORLD_KEY}/Base/{z}/{y}/{x}.png`, {
                attribution: 'VWorld'
            }).addTo(map);

            // 3. GPS ÏãúÏûë
            startGPS();
        }

        function startGPS() {
            if (!navigator.geolocation) {
                alert("GPS not supported");
                return;
            }

            // Ï≤´ ÏúÑÏπò Ïû°Í∏∞
            navigator.geolocation.getCurrentPosition((pos) => {
                updateGPS(pos);
                map.setView([pos.coords.latitude, pos.coords.longitude], 17);
            }, (err) => console.error(err), { enableHighAccuracy: true });

            // Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å
            watchId = navigator.geolocation.watchPosition(updateGPS, (err) => console.error(err), {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 5000
            });
        }

        function updateGPS(pos) {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            // ÎßàÏª§ ÏÉùÏÑ±/Ïù¥Îèô
            if (!gpsMarker) {
                const icon = L.divIcon({
                    className: 'gps-pulse-icon',
                    html: '<div class="gps-dot"></div><div class="gps-pulse"></div>',
                    iconSize: [20, 20]
                });
                gpsMarker = L.marker([lat, lng], { icon: icon }).addTo(map);
            } else {
                gpsMarker.setLatLng([lat, lng]);
            }

            // ÏßÄÎèÑ Ï§ëÏã¨ Ïù¥Îèô (Î∂ÄÎìúÎüΩÍ≤å)
            // ÏßÄÎèÑÍ∞Ä ÎÑàÎ¨¥ Î©ÄÏñ¥ÏßÄÏßÄ ÏïäÏïòÏúºÎ©¥ Îî∞ÎùºÍ∞ê. 
            // Îã®, ÏÇ¨Ïö©ÏûêÍ∞Ä ÌöåÏ†ÑÌïòÍ±∞ÎÇò Ï°∞Ïûë Ï§ëÏùº ÎïåÎ•º Í≥†Î†§Ìï¥ 'flyTo' ÎåÄÏã† 'panTo'ÎÇò 'setView' ÏÇ¨Ïö©
            // Ïó¨Í∏∞ÏÑúÎäî Îã®ÏàúÌïòÍ≤å "Î¨¥Ï°∞Í±¥ Îî∞ÎùºÍ∞ÄÍ∏∞"Î°ú ÌÖåÏä§Ìä∏ (ÌöåÏ†ÑÏù¥ ÌíÄÎ¶¨ÎäîÏßÄ ÌôïÏù∏Ïö©)
            // map.setView([lat, lng], map.getZoom(), {animate: true, duration: 0.5});
        }

        // Î≤ÑÌäº ÎàÑÎ•¥Î©¥ ÎÇ¥ ÏúÑÏπòÎ°ú
        document.getElementById('my-loc-btn').onclick = () => {
            if (gpsMarker) {
                map.setView(gpsMarker.getLatLng(), 17, { animate: true });
            }
        };

        window.onload = init;
    </script>
</body>

</html>